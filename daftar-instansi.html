<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Daftar Instansi - Deteksi AI</title>

  <!-- Font & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

  <!-- Tailwind CDN (prototyping) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
    :root{--accent:#0077ff}
    html,body{font-family:'Poppins',ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Arial}
    body{overflow-x:clip;background:linear-gradient(135deg,#eaf8ff,#ffffff)}
  </style>
</head>
<body class="text-gray-800">

  <!-- HEADER (consistent with other pages) -->
  <header class="fixed inset-x-0 top-0 z-50 bg-white/85 backdrop-blur-md shadow-md">
    <div class="max-w-7xl mx-auto px-6 py-3 flex items-center justify-between">
      <div class="flex items-center gap-6">
        <a href="beranda.php" aria-label="Ocealyze - Beranda" class="inline-flex items-center gap-3">
          <img src="merak.png" alt="merak" class="w-28 h-auto">
        </a>

        <nav class="hidden md:flex gap-6 text-sm font-semibold text-sky-600" aria-label="Main navigation">
          <a href="beranda.php" class="hover:underline">Beranda</a>
          <a href="tentang.php" class="hover:underline">Tentang Kami</a>
          <a href="layanan.php" class="hover:underline">Layanan</a>
          <a href="saran.php" class="hover:underline">Saran & Masukan</a>
        </nav>
      </div>

      <div class="flex items-center gap-4">
        <button id="logoutBtn" class="inline-flex items-center gap-2 bg-green-500 hover:bg-green-600 text-white text-sm font-semibold px-3 py-2 rounded-md shadow-sm" aria-label="Logout">
          <i class="fas fa-sign-out-alt"></i> Logout
        </button>
      </div>
    </div>
  </header>

  <main class="pt-24 pb-16">

    <!-- HERO -->
    <section class="w-screen bg-white py-16 px-6 lg:px-24">
      <div class="max-w-4xl mx-auto flex flex-col items-center text-center gap-4">
        <p class="text-lg text-gray-600 max-w-2xl">
          Daftarkan instansi atau unit kerja Anda untuk mengakses layanan pemerintah. Isi formulir pendaftaran berikut dengan lengkap.
        </p>
      </div>
    </section>

    <div class="max-w-7xl mx-auto px-6">

      <!-- FORM -->
      <section class="bg-white rounded-2xl shadow-lg p-6 md:p-10 mb-8">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-2xl font-bold text-sky-700">Form Daftar Instansi</h2>
          <div class="text-sm text-gray-500">Semua field bertanda * wajib diisi</div>
        </div>

        <form id="instansiForm" class="space-y-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-1">Nama Instansi / Unit *</label>
              <input id="namaInstansi" type="text" required placeholder="Contoh: Dinas Perikanan Kabupaten X" class="w-full rounded-lg border-2 border-gray-200 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-sky-200" />
              <p id="err-namaInstansi" class="mt-1 text-sm text-red-600 hidden">Nama instansi wajib diisi</p>
            </div>

            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-1">Jenis Instansi *</label>
              <select id="jenisInstansi" required class="w-full rounded-lg border-2 border-gray-200 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-sky-200">
                <option value="">Pilih jenis</option>
                <option value="pemerintah">Pemerintah</option>
                <option value="koperasi">Koperasi</option>
                <option value="pemilik-usaha">Pemilik Usaha</option>
                <option value="lembaga-penelitian">Lembaga Penelitian</option>
                <option value="lainnya">Lainnya</option>
              </select>
              <p id="err-jenisInstansi" class="mt-1 text-sm text-red-600 hidden">Pilih jenis instansi</p>
            </div>

            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-1">Alamat Lengkap *</label>
              <input id="alamat" type="text" required placeholder="Alamat lengkap instansi" class="w-full rounded-lg border-2 border-gray-200 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-sky-200" />
              <p id="err-alamat" class="mt-1 text-sm text-red-600 hidden">Alamat wajib diisi</p>
            </div>

            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-1">Kota / Kabupaten *</label>
              <input id="kota" type="text" required placeholder="Contoh: Surabaya" class="w-full rounded-lg border-2 border-gray-200 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-sky-200" />
              <p id="err-kota" class="mt-1 text-sm text-red-600 hidden">Kota wajib diisi</p>
            </div>

            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-1">Provinsi *</label>
              <input id="provinsi" type="text" required placeholder="Contoh: Jawa Timur" class="w-full rounded-lg border-2 border-gray-200 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-sky-200" />
              <p id="err-provinsi" class="mt-1 text-sm text-red-600 hidden">Provinsi wajib diisi</p>
            </div>

            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-1">Nomor Telepon / WA *</label>
              <input id="telepon" type="tel" required placeholder="+62 812 3456 7890" class="w-full rounded-lg border-2 border-gray-200 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-sky-200" />
              <p id="err-telepon" class="mt-1 text-sm text-red-600 hidden">Nomor telepon wajib diisi</p>
            </div>

            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-1">Email Kontak *</label>
              <input id="emailKontak" type="email" required placeholder="kontak@instansi.go.id" class="w-full rounded-lg border-2 border-gray-200 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-sky-200" />
              <p id="err-emailKontak" class="mt-1 text-sm text-red-600 hidden">Email harus valid</p>
            </div>

            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-1">Penanggung Jawab (Nama)</label>
              <input id="pjNama" type="text" placeholder="Nama penanggung jawab" class="w-full rounded-lg border-2 border-gray-200 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-sky-200" />
            </div>
          </div>

          <!-- Upload Dokumen -->
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-1">Dokumen Pendukung (Surat Permohonan / SK / KTP) — JPG/PNG/PDF, max 5MB</label>
            <div class="flex gap-3 items-center">
              <input id="dokumen" type="file" accept=".pdf,.png,.jpg,.jpeg" class="block" />
              <div id="fileInfo" class="text-sm text-gray-600"></div>
              <button id="removeFileBtn" type="button" class="hidden text-sm text-red-600"><i class="fas fa-times-circle"></i> Hapus</button>
            </div>
            <p id="err-dokumen" class="mt-1 text-sm text-red-600 hidden">Format file tidak valid atau ukuran &gt; 5MB</p>
          </div>

          <!-- Optional notes -->
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-1">Catatan / Keterangan (opsional)</label>
            <textarea id="catatan" rows="3" placeholder="Informasi tambahan" class="w-full rounded-lg border-2 border-gray-200 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-sky-200"></textarea>
          </div>

          <!-- Actions -->
          <div class="flex gap-3 justify-end">
            <button type="reset" id="resetForm" class="inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-gray-200 text-gray-700 hover:bg-gray-50">
              <i class="fas fa-undo"></i> Reset
            </button>
            <button type="submit" id="submitInstansi" class="inline-flex items-center gap-2 px-5 py-3 rounded-lg bg-gradient-to-r from-sky-600 to-cyan-400 text-white font-semibold shadow">
              <i class="fas fa-check-circle"></i> Daftarkan Instansi
            </button>
          </div>
        </form>
      </section>

      <!-- Registered list + tools -->
      <section class="bg-white rounded-2xl shadow-lg p-6 md:p-8 mb-12">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-4">
          <h3 class="text-xl font-semibold text-sky-700">Daftar Instansi Terdaftar</h3>
          <div class="flex items-center gap-3">
            <input id="searchInput" type="text" placeholder="Cari nama / kota / jenis..." class="rounded-lg border-2 border-gray-200 px-4 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200" />
            <button id="exportCsv" class="inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-gray-200 hover:bg-gray-50">
              <i class="fas fa-file-csv"></i> Export CSV
            </button>
            <button id="clearAll" class="inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-red-200 text-red-600 hover:bg-red-50">
              <i class="fas fa-trash-alt"></i> Hapus Semua
            </button>
          </div>
        </div>

        <div id="listContainer" class="space-y-3"></div>

        <div id="emptyList" class="text-center py-10 text-gray-500">
          <i class="fas fa-clipboard-list text-3xl mb-3"></i>
          <div class="font-semibold">Belum ada instansi terdaftar</div>
          <div class="text-sm mt-1">Isi formulir di atas untuk menambahkan instansi</div>
        </div>
      </section>

    </div> <!-- /container -->

  </main>
<!-- FOOTER (Tailwind) -->
<footer class="w-screen bg-white/90 mt-12 mb-12">
  <div class="max-w-7xl mx-auto px-6 py-10">

    <div class="grid grid-cols-1 md:grid-cols-4 gap-8 items-start text-center md:text-left">

  <!-- Brand -->
  <div class="footer-section">
    <h3 class="text-sky-700 font-bold text-lg">SKIPM Merak</h3>

    <div class="flex justify-center md:justify-start gap-3 mt-4">
      <a href="#" class="text-sky-600 hover:text-sky-800"><i class="fab fa-facebook-f"></i></a>
      <a href="#" class="text-sky-600 hover:text-sky-800"><i class="fab fa-twitter"></i></a>
      <a href="#" class="text-sky-600 hover:text-sky-800"><i class="fab fa-instagram"></i></a>
      <a href="#" class="text-sky-600 hover:text-sky-800"><i class="fab fa-linkedin-in"></i></a>
    </div>
  </div>

  <!-- Alamat -->
  <div class="footer-section">
    <h3 class="text-sky-700 font-bold text-lg">Alamat</h3>

    <p class="text-gray-600 mt-3 text-sm">
      Jalan Raya Tol Merak Km.01<br>
      Pelabuhan Penyeberangan Merak,<br>
      Gerem, Kec. Gerogol,<br>
      Kota Cilegon, Banten 42438
    </p>
  </div>

  <!-- Lokasi (Map) — diperlebar & diposisikan lebih ke tengah -->
  <div class="footer-section md:col-span-2 md:pl-6">
    <h3 class="text-sky-700 font-bold text-lg mb-3">Lokasi Kami</h3>

    <div class="w-full h-56 rounded-xl overflow-hidden shadow">
      <iframe 
        src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3966.616701987579!2d105.994096!3d-6.186607!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x2e418d2765955691%3A0xe2783e47a032e0cd!2sStasiun%20Karantina%20Ikan%20Pengendalian%20Mutu%20dan%20Keamanan%20Hasil%20Perikanan%20Kelas%20I%20Merak!5e0!3m2!1sen!2sid!4v1700000000000"
        width="100%" height="100%" allowfullscreen="" loading="lazy">
      </iframe>
    </div>
  </div>

</div>


    <!-- Copyright -->
    <div class="border-t border-gray-100 mt-8 pt-6 text-center">
      <p class="text-gray-500 text-sm">&copy;Copyright 2025 Stasiun Karantina Ikan Merak.</p>
    </div>

  </div>
</footer>

<script>
  // Logout logic
  (function () {
    const logoutBtn = document.getElementById('logoutBtn');
    if (!logoutBtn) return;
    logoutBtn.addEventListener('click', function () {
      if (window.Swal) {
        Swal.fire({
          title: "Yakin ingin logout?",
          text: "Kamu akan kembali ke halaman login.",
          icon: "warning",
          showCancelButton: true,
          confirmButtonText: "Ya, logout",
          cancelButtonText: "Batal",
          confirmButtonColor: "#28a745",
          cancelButtonColor: "#aaa"
        }).then((result) => {
          if (result.isConfirmed) {
            Swal.fire({ title: "Logout berhasil!", icon: "success", timer: 1200, showConfirmButton: false });
            setTimeout(() => window.location.href = "login.php", 1200);
          }
        });
      } else {
        if (confirm("Yakin ingin logout?")) window.location.href = "login.php";
      }
    });
  })();

  // Footer animation
  (function () {
    if (!('IntersectionObserver' in window)) return;
    const io = new IntersectionObserver((entries) => {
      entries.forEach(e => {
        if (e.isIntersecting) {
          e.target.classList.add('opacity-100','translate-y-0');
          io.unobserve(e.target);
        }
      });
    }, { threshold: 0.12 });

    document.querySelectorAll('.footer-section').forEach(el => {
      el.classList.add('opacity-0','translate-y-6','transition','duration-700','ease-out');
      io.observe(el);
    });
  })();
</script>

  <!-- SCRIPTS: validation, localStorage, render, export -->
  <script>
    // Utility helpers
    const qs = s => document.querySelector(s);
    const qsa = s => Array.from(document.querySelectorAll(s));
    const MAX_FILE_MB = 5;

    // Elements
    const form = qs('#instansiForm');
    const dokInput = qs('#dokumen');
    const fileInfo = qs('#fileInfo');
    const removeFileBtn = qs('#removeFileBtn');
    const errDok = qs('#err-dokumen');
    const listContainer = qs('#listContainer');
    const emptyList = qs('#emptyList');
    const searchInput = qs('#searchInput');

    // Load saved list from localStorage
    let saved = JSON.parse(localStorage.getItem('ocealyze_instansi') || '[]');

    // Escape helper (simple)
    function escapeHtml(str = '') {
      return String(str).replace(/[&<>"']/g, function(m) {
        return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m];
      });
    }

    // Render list
    function renderList(filter = '') {
      if (!saved.length) {
        listContainer.innerHTML = '';
        emptyList.style.display = 'block';
        return;
      }
      emptyList.style.display = 'none';
      const q = filter.trim().toLowerCase();
      const filtered = saved.filter(item => {
        if (!q) return true;
        return [item.namaInstansi, item.kota, item.jenisInstansi].some(v => (v||'').toLowerCase().includes(q));
      });
      listContainer.innerHTML = filtered.map(item => {
        const docLabel = item.dokumenName ? `<a href="${item.dokumenURL}" target="_blank" class="text-sky-600 hover:underline">${escapeHtml(item.dokumenName)}</a>` : '<span class="text-gray-400">-</span>';
        return `
          <div class="border rounded-lg p-4 flex flex-col md:flex-row md:items-start md:justify-between gap-3">
            <div>
              <div class="text-lg font-semibold text-gray-800">${escapeHtml(item.namaInstansi)}</div>
              <div class="text-sm text-gray-500">${escapeHtml(item.jenisInstansi)} — ${escapeHtml(item.kota)}, ${escapeHtml(item.provinsi)}</div>
              <div class="text-sm text-gray-600 mt-2">${escapeHtml(item.alamat)}</div>
              <div class="text-sm text-gray-600 mt-2">Kontak: ${escapeHtml(item.telepon)} • ${escapeHtml(item.emailKontak)}</div>
              <div class="text-sm text-gray-600 mt-2">Dokumen: ${docLabel}</div>
              ${item.catatan ? `<div class="text-sm text-gray-600 mt-2">Catatan: ${escapeHtml(item.catatan)}</div>` : ''}
            </div>
            <div class="flex items-center gap-2">
              <button data-id="${item.id}" class="btn-delete inline-flex items-center gap-2 px-3 py-2 rounded-md border border-red-200 text-red-600 hover:bg-red-50"><i class="fas fa-trash"></i> Hapus</button>
            </div>
          </div>
        `;
      }).join('');
      // attach delete handlers
      qsa('.btn-delete').forEach(btn => btn.addEventListener('click', (e) => {
        const id = e.currentTarget.dataset.id;
        Swal.fire({
          title: 'Hapus Instansi?',
          text: 'Data akan dihapus dari penyimpanan lokal.',
          icon: 'warning',
          showCancelButton: true,
          confirmButtonText: 'Hapus',
          cancelButtonText: 'Batal'
        }).then(res => {
          if (res.isConfirmed) {
            saved = saved.filter(s => s.id !== id);
            localStorage.setItem('ocealyze_instansi', JSON.stringify(saved));
            renderList(searchInput.value);
            Swal.fire({ title: 'Terhapus', icon: 'success', timer: 900, showConfirmButton: false });
          }
        });
      }));
    }

    // File handling
    let currentFile = null;
    dokInput.addEventListener('change', function() {
      errDok.classList.add('hidden');
      fileInfo.textContent = '';
      removeFileBtn.classList.add('hidden');
      const file = this.files[0];
      if (!file) return;
      const validTypes = ['application/pdf','image/png','image/jpeg'];
      if (!validTypes.includes(file.type) || (file.size > MAX_FILE_MB * 1024 * 1024)) {
        errDok.classList.remove('hidden');
        this.value = '';
        currentFile = null;
        return;
      }
      currentFile = file;
      fileInfo.innerHTML = `<span class="text-sm text-gray-600">${file.name} · ${(file.size/1024/1024).toFixed(2)} MB</span>`;
      removeFileBtn.classList.remove('hidden');
    });

    removeFileBtn.addEventListener('click', () => {
      dokInput.value = '';
      currentFile = null;
      fileInfo.textContent = '';
      removeFileBtn.classList.add('hidden');
    });

    // Form validation
    function validateForm(data) {
      let ok = true;
      qsa('[id^="err-"]').forEach(el => el.classList.add('hidden'));
      if (!data.namaInstansi) { qs('#err-namaInstansi').classList.remove('hidden'); ok = false; }
      if (!data.jenisInstansi) { qs('#err-jenisInstansi').classList.remove('hidden'); ok = false; }
      if (!data.alamat) { qs('#err-alamat').classList.remove('hidden'); ok = false; }
      if (!data.kota) { qs('#err-kota').classList.remove('hidden'); ok = false; }
      if (!data.provinsi) { qs('#err-provinsi').classList.remove('hidden'); ok = false; }
      if (!data.telepon) { qs('#err-telepon').classList.remove('hidden'); ok = false; }
      if (!data.emailKontak || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(data.emailKontak)) { qs('#err-emailKontak').classList.remove('hidden'); ok = false; }
      return ok;
    }

    // Submit handler
    form.addEventListener('submit', function(e) {
      e.preventDefault();
      const data = {
        id: String(Date.now()),
        namaInstansi: qs('#namaInstansi').value.trim(),
        jenisInstansi: qs('#jenisInstansi').value,
        alamat: qs('#alamat').value.trim(),
        kota: qs('#kota').value.trim(),
        provinsi: qs('#provinsi').value.trim(),
        telepon: qs('#telepon').value.trim(),
        emailKontak: qs('#emailKontak').value.trim(),
        pjNama: qs('#pjNama').value.trim(),
        catatan: qs('#catatan').value.trim(),
        dokumenName: null,
        dokumenURL: null
      };

      if (!validateForm(data)) {
        Swal.fire({ title: 'Form Tidak Lengkap', text: 'Periksa field yang wajib diisi.', icon: 'warning', confirmButtonText: 'Mengerti' });
        return;
      }

      // handle file (object URL for demo)
      if (currentFile) {
        data.dokumenName = currentFile.name;
        data.dokumenURL = URL.createObjectURL(currentFile);
      }

      saved.unshift(data);
      localStorage.setItem('ocealyze_instansi', JSON.stringify(saved));

      Swal.fire({ title: 'Terdaftar', text: 'Instansi berhasil didaftarkan.', icon: 'success', timer: 1000, showConfirmButton: false });

      form.reset();
      removeFileBtn.click();
      renderList(searchInput.value);
    });

    // Search
    searchInput.addEventListener('input', function() {
      renderList(this.value);
    });

    // Export CSV
    qs('#exportCsv').addEventListener('click', function() {
      if (!saved.length) {
        Swal.fire({ title: 'Kosong', text: 'Tidak ada data untuk diekspor.', icon: 'info' });
        return;
      }
      const rows = [
        ['id','namaInstansi','jenisInstansi','alamat','kota','provinsi','telepon','emailKontak','pjNama','dokumenName','catatan','timestamp']
      ];
      saved.forEach(s => {
        rows.push([
          s.id,
          s.namaInstansi,
          s.jenisInstansi,
          s.alamat,
          s.kota,
          s.provinsi,
          s.telepon,
          s.emailKontak,
          s.pjNama || '',
          s.dokumenName || '',
          s.catatan || '',
          s.id
        ]);
      });
      const csv = rows.map(r => r.map(cell => `"${String(cell).replace(/"/g,'""')}"`).join(',')).join('\n');
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'daftar_instansi_ocealyze.csv';
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    });

    // Clear all data
    qs('#clearAll').addEventListener('click', function() {
      if (!saved.length) {
        Swal.fire({ title: 'Kosong', text: 'Tidak ada data untuk dihapus.', icon: 'info' });
        return;
      }
      Swal.fire({
        title: 'Hapus semua data?',
        text: 'Semua entri yang tersimpan di localStorage akan dihapus.',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Hapus Semua',
      }).then(res => {
        if (res.isConfirmed) {
          saved = [];
          localStorage.removeItem('ocealyze_instansi');
          renderList();
          Swal.fire({ title: 'Terhapus', icon: 'success', timer: 900, showConfirmButton: false });
        }
      });
    });

    // Reset form button behaviour
    qs('#resetForm').addEventListener('click', function() {
      dokInput.value = '';
      currentFile = null;
      fileInfo.textContent = '';
      removeFileBtn.classList.add('hidden');
      qsa('[id^="err-"]').forEach(el => el.classList.add('hidden'));
    });

    // Logout handler (consistent)
    (function () {
      const btn = document.getElementById('logoutBtn');
      if (!btn) return;
      btn.addEventListener('click', () => {
        if (window.Swal) {
          Swal.fire({
            title: "Yakin ingin logout?",
            text: "Kamu akan kembali ke halaman login.",
            icon: "warning",
            showCancelButton: true,
            confirmButtonText: "Ya, logout",
            cancelButtonText: "Batal",
          }).then((res) => {
            if (res.isConfirmed) {
              Swal.fire({ title: "Logout berhasil!", icon: "success", timer: 900, showConfirmButton: false });
              setTimeout(() => window.location.href = "login.php", 900);
            }
          });
        } else {
          if (confirm("Yakin ingin logout?")) window.location.href = "login.php";
        }
      });
    })();

    // Init render
    document.addEventListener('DOMContentLoaded', () => {
      renderList();
    });
  </script>
</body>
</html>
